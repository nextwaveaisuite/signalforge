"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")},3837:e=>{e.exports=require("util")},5324:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>q,requestAsyncStorage:()=>S,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>v,dynamic:()=>m,runtime:()=>x});var o=t(9303),i=t(8716),n=t(670),p=t(7070),a=t(8472);let u=require("fs");var c=t.n(u),d=t(1017),l=t.n(d);let h=l().join(process.cwd(),"data","users.json"),x="nodejs",m="force-dynamic",g=new a.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"});async function v(e){let r;let t=e.headers.get("stripe-signature");if(!t)return p.NextResponse.json({error:"Missing signature"},{status:400});let s=await e.text();try{r=g.webhooks.constructEvent(s,t,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return p.NextResponse.json({error:`Webhook signature error: ${e.message}`},{status:400})}if("checkout.session.completed"===r.type){let e=r.data.object.customer;e&&function(e,r){c().existsSync(h)||(c().mkdirSync(l().dirname(h),{recursive:!0}),c().writeFileSync(h,JSON.stringify({users:{}},null,2)));let t=JSON.parse(c().readFileSync(h,"utf8"));t.users[e]={plan:"pro"},c().writeFileSync(h,JSON.stringify(t,null,2))}(e,0)}return p.NextResponse.json({received:!0})}let y=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"/workspaces/signalforge/app/api/stripe/webhook/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:S,staticGenerationAsyncStorage:f,serverHooks:w}=y,k="/api/stripe/webhook/route";function q(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,472],()=>t(5324));module.exports=s})();