import { NextResponse } from "next/server";
import fs from "fs";

const USERS_FILE = process.cwd() + "/data/users.json";

function loadUsers() {
  try {
    return JSON.parse(fs.readFileSync(USERS_FILE, "utf8"));
  } catch {
    return { users: {} };
  }
}

export async function GET() {
  const customerId = process.env.TEST_CUSTOMER_ID || null;

  if (!customerId) {
    return NextResponse.json({ plan: "free" });
  }

  const data = loadUsers();
  const entry = data.users[customerId];

  return NextResponse.json({
    plan: entry?.plan || "free",
  });
}
